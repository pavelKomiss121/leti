# Курсовая работа. Статистический анализ и моделирование данных на примере базы данных «Rain in Australia»

*(Титульный лист оформляется отдельно по требованиям кафедры.)*

---

## 1. Введение

### 1.1. Тема и цель работы

**Тема:** Статистический анализ и моделирование данных на основе выборки с параметрами n, m и целевой переменной на примере базы данных «Rain in Australia».

**Цель:** Освоить полный цикл анализа данных: от первичного осмотра и визуализации до применения многомерных статистических методов и интерпретации результатов.

### 1.2. Выбор датасета и параметров

Использован датасет **Rain in Australia** (файл `weatherAUS.csv`, источник: [Kaggle — Weather Dataset Rattle Package](https://www.kaggle.com/datasets/jsphyg/weather-dataset-rattle-package)). Данные — ежедневные метеонаблюдения по Австралии (период 2007–2017, 49 локаций).

- **Параметр n:** Humidity3pm (влажность в 15:00, %).
- **Параметр m:** Rainfall (осадки за день, мм).
- **Целевая переменная:** RainTomorrow (будет ли дождь завтра: Yes/No).

В анализе использованы также другие числовые признаки (температура, давление, скорость ветра и т.д.) для корреляций, регрессии и классификации. Категориальные признаки (Location, направление ветра) при построении моделей не использовались (Location — 49 уникальных значений; фокус на числовых признаках).

### 1.3. Инструменты и структура проекта

Реализация выполнена на **Python** в виде модулей: загрузка и очистка данных (`data.py`), визуализация (`viz.py`), корреляционный анализ (`correlation.py`), регрессия (`regression.py`), ANOVA (`anova.py`), классификаторы (`classifier.py`). Точка входа — `main.py`. Запуск из корня репозитория: `python -m course_work.main`.

Интерпретация результатов опирается на уровни аналитики по Морроу (описательный, диагностический, предсказательный) [Дж. Морроу. Как вытащить из данных максимум. Навыки аналитики для неспециалистов, 2022].

---

## 2. Часть 1. Подготовительный этап и разведочный анализ (EDA)

### 2.1. Задание 1. Первичная обработка данных

**Описание данных.** Таблица содержит ежедневные метеонаблюдения: числовые признаки (MinTemp, MaxTemp, Rainfall, Humidity9am, Humidity3pm, Pressure9am, Pressure3pm, скорость ветра и др.) и категориальные (Location, направление ветра, RainToday, RainTomorrow). Теоретические ограничения: влажность 0–100%, осадки ≥ 0; для региона учтены экстремальные аномалии (например, Rainfall > 300 мм — редкие ливни).

**Проверка качества.** Выполнена проверка пропусков (доля по столбцам), дубликатов строк и аномалий (Rainfall < 0 или > 300 мм, Humidity3pm вне [0, 100], отрицательные скорости ветра). Столбцы с долей пропусков более 40% (Evaporation, Sunshine, Cloud9am, Cloud3pm) удалены. Строки с пропуском в целевом признаке RainTomorrow удалены.

**Стратегия обработки.** Дата преобразована в тип datetime. Для числовых признаков выполнена импутация медианой, для категориальных (направление ветра, RainToday) — модой. Отрицательные значения скоростей ветра заменены на 0. Обработка выбросов выполнена **без удаления строк**: для Rainfall — winsorize по 99-му перцентилю (сохранение дождливых дней); для Humidity3pm — winsorize по границам 1.5×IQR. Удалены только строки с экстремальными аномалиями (Rainfall < 0 или > 300 мм, Humidity3pm вне [0, 100]).

**Результат.** Размер выборки до обработки — порядка 145 000 строк. После обработки — *подставить фактическое число из вывода программы*. Удалённые столбцы: Evaporation, Sunshine, Cloud9am, Cloud3pm. Сохранение распределения целевой переменной (доля Yes около 22–23%) подтверждено проверкой баланса классов в конце задания 1.

*По Морроу: первичная обработка — основа диагностического уровня аналитики («почему данные такие»).*

### 2.2. Задание 2. Визуализация и описательная статистика

Построены графики распределения параметров **n** (Humidity3pm) и **m** (Rainfall) с разбивкой по классам RainTomorrow (подписи осей, легенда, сетка).

![Рисунок 1 — Распределения Humidity3pm и Rainfall по классам](../figures/task2_distributions_by_class.png)

*Рисунок 1 — Распределения Humidity3pm (n) и Rainfall (m) по классам RainTomorrow*

Рассчитаны медиана, среднее и стандартное отклонение для n и m по всей выборке и по каждому классу (таблица выводится при запуске программы).

Построены гистограммы, scatterplot и boxplot для подвыборок «выше медианы» и «ниже медианы» по n и по m; оценено СКО в каждой подвыборке.

![Рисунок 2 — Выше/ниже медианы Humidity3pm](../figures/task2_above_below_median_humidity3pm.png)

*Рисунок 2 — Разбивка по медиане Humidity3pm: гистограмма, scatter (n vs m), boxplot по классам*

![Рисунок 3 — Выше/ниже медианы Rainfall](../figures/task2_above_below_median_rainfall.png)

*Рисунок 3 — Разбивка по медиане Rainfall*

Оценена сбалансированность классов RainTomorrow (доля No около 78%, Yes около 22%). Визуализация — bar и pie chart.

![Рисунок 4 — Баланс классов RainTomorrow](../figures/task2_class_balance.png)

*Рисунок 4 — Баланс классов целевой переменной*

**Интерпретация.** Несбалансированность (78/22) типична для задачи предсказания дождя и учитывается при оценке моделей (метрики F1, Recall, AUC; стратифицированное разбиение; при необходимости SMOTE и class_weight='balanced'). Высокое СКО по Rainfall связано с редкими сильными осадками — по Морроу это диагностический аспект («почему разброс такой»).

---

## 3. Часть 2. Моделирование и прогнозирование

### 3.1. Задание 3. Корреляционный анализ

Построены тепловые карты корреляций (Пирсон и Спирмен) по числовым признакам. Коэффициенты Пирсона использованы для признаков, близких к нормальному распределению; Спирмена — для скошенных (в частности, Rainfall).

![Рисунок 5 — Тепловая карта корреляций (Пирсон)](../figures/task3_heatmap_pearson.png)

*Рисунок 5 — Тепловая карта корреляций Пирсона*

![Рисунок 6 — Тепловая карта корреляций (Спирмен)](../figures/task3_heatmap_spearman.png)

*Рисунок 6 — Тепловая карта корреляций Спирмена*

Выявлены пары признаков с |r| > 0.8 (мультиколлинеарность); результат выводится в консоль. Учёт мультиколлинеарности при множественной регрессии при необходимости выполняется через VIF.

*По Морроу: корреляционный анализ поддерживает диагностический уровень («почему» связь между признаками и целевой).*

### 3.2. Задание 4. Регрессионный анализ

Построены две модели простой линейной регрессии: (1) предсказание n (Humidity3pm) по m (Rainfall); (2) предсказание m (Rainfall) по n (Humidity3pm). Разбиение выборки — 70% обучающая / 30% тестовая с сохранением доли классов (stratify=RainTomorrow).

Оценено качество: R², MSE, RMSE; проверена статистическая значимость коэффициентов (OLS, statsmodels). Построен график остатков (предсказание vs остаток) для обеих регрессий.

![Рисунок 7 — Остатки регрессий](../figures/task4_residuals.png)

*Рисунок 7 — Остатки: n от m и m от n*

**Результаты.** R² для обеих регрессий ожидаемо невысокий (порядка 0,05–0,15): связь между влажностью и осадками не строго линейна. Конкретные значения R², MSE, RMSE и выводы по значимости коэффициентов приведены в выводе программы. *По Морроу: предсказательный уровень показывает ограничения простой линейной модели для данных сложной природы.*

---

## 4. Часть 3. Проверка статистических гипотез

### 4.1. Задание 6. Дисперсионный анализ (ANOVA)

Сформулирована нулевая гипотеза **H₀:** средние значения параметра n (Humidity3pm) не различаются между классами RainTomorrow. Проверена предпосылка однородности дисперсий (тест Левена). Выполнён однофакторный ANOVA (F-статистика и p-value), рассчитан размер эффекта (eta-squared).

При двух группах (Yes/No) ANOVA эквивалентна t-критерию Стьюдента для двух выборок. Пост-хок анализ применяется только при числе групп больше двух.

**Результаты.** Значения F, p-value и eta-squared выводятся при запуске программы. При p < 0,05 делается вывод о значимых различиях средних Humidity3pm между классами RainTomorrow.

### 4.2. Задание 7. Создание классификатора

Построены три классификатора для предсказания RainTomorrow по числовым признакам (n, m и другим): логистическая регрессия, дерево решений, многослойный перцептрон (MLP). Использованы балансировка классов (class_weight='balanced' для логистической регрессии и дерева; SMOTE на обучающей выборке по умолчанию), разбиение 70% / 30% со стратификацией, масштабирование признаков (StandardScaler). Для дерева задано ограничение глубины (max_depth) с целью снижения переобучения.

Оценено качество: матрица ошибок, Accuracy, Precision, Recall, F1-score, AUC. Проведена кросс-валидация 5-fold StratifiedKFold для метрик F1 и AUC с целью более устойчивой оценки при дисбалансе классов. Построены ROC-кривые для всех трёх моделей и график зависимости F1 и AUC от max_depth для дерева решений.

![Рисунок 8 — ROC-кривые классификаторов](../figures/task7_roc_curves.png)

*Рисунок 8 — ROC-кривые: LogisticRegression, DecisionTree, MLP*

![Рисунок 9 — Влияние max_depth на F1 и AUC (DecisionTree)](../figures/task7_tree_max_depth.png)

*Рисунок 9 — Перебор max_depth (3, 5, 7, 10, 15): F1 и AUC по 5-fold CV*

Сводная таблица метрик (в том числе F1 и AUC по single split и по 5-fold CV) выводится в консоль. При дисбалансе 78/22 основное внимание уделяется F1 и AUC, а не только Accuracy.

*По Морроу: классификаторы реализуют предсказательный уровень аналитики («что будет» — будет ли дождь завтра).*

---

## 5. Заключение

В работе выполнен полный цикл анализа данных по методическим указаниям: первичная обработка и разведочный анализ (EDA), корреляционный и регрессионный анализ, проверка статистических гипотез (ANOVA) и построение классификаторов. В качестве данных использован датасет «Rain in Australia» с параметрами n = Humidity3pm, m = Rainfall и целевой переменной RainTomorrow.

Основные выводы:
- Обработка выбросов без массового удаления строк (winsorize) позволила сохранить распределение целевой переменной и информативность признака Rainfall.
- Оба признака (Humidity3pm и Rainfall) обладают предсказательной способностью относительно RainTomorrow; выявлена несбалансированность классов (78/22), учтённая при обучении и оценке моделей.
- Простая линейная регрессия между n и m даёт невысокий R², что отражает нелинейность связи.
- ANOVA подтверждает значимые различия средних Humidity3pm между классами RainTomorrow (при p < 0,05).
- Классификаторы (логистическая регрессия, дерево решений, MLP) с балансировкой и 5-fold CV позволяют получить устойчивые оценки F1 и AUC; ограничение max_depth для дерева снижает переобучение.

Рекомендации для дальнейшей работы: при необходимости — множественная регрессия с учётом VIF; расширение на мультикласс (например, по Location) для полноценного пост-хок анализа ANOVA; при необходимости — прескриптивный уровень (рекомендации по действиям на основе прогноза дождя).

---

## 6. Приложения

**Структура кода курсовой (каталог course_work):**
- `main.py` — запуск пайплайна (задания 1–7).
- `data.py` — загрузка и первичная обработка данных.
- `viz.py` — визуализация и описательная статистика (задание 2).
- `correlation.py` — корреляционный анализ (задание 3).
- `regression.py` — регрессионный анализ (задание 4).
- `anova.py` — дисперсионный анализ (задание 6).
- `classifier.py` — классификаторы, метрики, ROC, перебор max_depth (задание 7).
- `utils.py` — вспомогательные функции (filter_iqr, winsorize).
- `data/` — исходный файл weatherAUS.csv.
- `figures/` — сохранённые графики (task2_*, task3_*, task4_*, task7_*).

**Запуск:** из корня репозитория выполнить `python -m course_work.main`.

**Журнал хода работы:** см. файл `ХОД_РАБОТЫ.md` в каталоге `текст/`.
